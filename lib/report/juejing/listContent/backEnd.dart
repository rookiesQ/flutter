
import 'package:hk_app/data/category.dart';
import 'package:flutter/material.dart';
import 'dart:convert';
import 'package:hk_app/util/http.dart';
class listContent extends StatefulWidget {
  final list;
  listContent(this.list):super();
  @override
  _listContentState createState() => _listContentState();
}

class _listContentState extends State<listContent> {
  
  @override
  Widget build(BuildContext context) {
    return FutureBuilder(
      future: getArticle(category:widget.list.id),
      builder: (context ,AsyncSnapshot snapshot){
         switch (snapshot.connectionState) {
          case ConnectionState.none: 
          return StateNone();
          break;
          case ConnectionState.waiting: 
          return StateNone();
          break;
          case ConnectionState.done: 
              Map<String, dynamic> json = jsonDecode(snapshot.data);
              //var data = Autogenerated.fromJson(json);
              if (json['m']=='ok'){
                return ListContent(list: json['d']);
              } else{
                return StateNone();
              }
            break;
          
          case ConnectionState.active:
            return StateNone();
            // TODO: Handle this case.
            break;
        }
        return null;
        
      },
    );
  }
}

// 构建未获取数据渲染界面
class StateNone extends StatefulWidget {
  @override
  _StateNoneState createState() => _StateNoneState();
}

class _StateNoneState extends State<StateNone> {
  @override
  Widget build(BuildContext context) {
    return Container(
      child: Center(child: Text('加载中'),),
    );
  }
}


// 加载列表数据
class ListContent extends StatefulWidget {
  final list;
  @override
  ListContent({this.list}):super();
  _ListContentState createState() => _ListContentState();
}

class _ListContentState extends State<ListContent> {
  @override
  Widget build(BuildContext context) {
    var listTiles= <Widget>[];
    widget.list['entrylist'].forEach((li){
      listTiles.add(
          ListTile(
            title: Text(li['title']),
            isThreeLine: true,
            
            dense: true ,
            subtitle:Text(li['content']),
          )
      );
      listTiles.add(
          Divider()
      );
    });
    return ListView(children: listTiles);
  }
}